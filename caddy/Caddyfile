# Caddyfile pour GainTempsIA

# Site principal
ia.duhaz.fr {
    root * /var/www/gaintemps-ia
    file_server
    encode gzip
    
    # Proxy pour l'API
    handle /api/* {
        reverse_proxy localhost:3000
    }
    
    # Gestion des erreurs 404
    handle_errors {
        @404 {
            expression {http.error.status_code} == 404
        }
        rewrite @404 /index.html
    }
    
    # Headers de sécurité
    header {
        # Protection XSS
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        
        # HTTPS strict
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }
    
    # Cache pour les assets statiques
    @static {
        path *.css *.js *.png *.jpg *.jpeg *.gif *.svg *.ico *.woff *.woff2
    }
    header @static Cache-Control "public, max-age=31536000"
}

# Redirection www vers non-www
www.ia.duhaz.fr {
    redir https://ia.duhaz.fr{uri} permanent
}
